#+title: Todo

Work Todos

* DoseSpot [11/11]
** [X] WE-696: DoseSpot V2 JSON
:LOGBOOK:
CLOCK: [2024-06-03 Mon 09:48]--[2024-06-03 Mon 10:13] =>  0:25
:END:
** [X] [[https://hellowisp.atlassian.net/browse/WISPENG-125][WISPENG-125]]: Use 'GetMedicationByNDC' instead of 'GetMedicationByNameAndStrength' for DoseSpot V2
** NO [[https://hellowisp.atlassian.net/browse/WISPENG-260][WISPENG-260]]: Combine "GenericProductName" and "GenericDrugName"
- Note taken on [2024-06-10 Mon 13:20] \\
  Won't do. There is no equivalent for "GenericProductName" in DoseSpot V2.
- Note taken on [2024-06-10 Mon 11:32] \\
  We may not need to do this one, depending on what DoseSpot says.
** [X] [[https://github.com/hellowisp/secure.hellowisp.com/pull/4259][WISPENG-266]]: Adds metadata check in dispensable_drug_id property
- Note taken on [2024-06-07 Fri 15:02] \\
  Currently in draft. Publish it on Monday morning and get reviews.
** [X] Prepare for the DoseSpot call on 2024-06-10 by checking the V1 vs V2 changes for generic product name
:LOGBOOK:
CLOCK: [2024-06-10 Mon 11:18]--[2024-06-10 Mon 11:31] =>  0:13
CLOCK: [2024-06-10 Mon 10:46]--[2024-06-10 Mon 11:11] =>  0:25
CLOCK: [2024-06-10 Mon 10:10]--[2024-06-10 Mon 10:35] =>  0:25
:END:
** [X] [[https://github.com/hellowisp/secure.hellowisp.com/pull/4265][WISPENG-268]]: When getting a medication by RxCUI in V2, ~DrugName~ is null in service response, but not in API JSON response.
:LOGBOOK:
CLOCK: [2024-06-10 Mon 11:52]--[2024-06-10 Mon 12:17] =>  0:25
:END:
- Note taken on [2024-06-10 Mon 11:35] \\
  Need tests for this. Tests should have failed before when this didn't work.
** [X] [[https://hellowisp.atlassian.net/browse/WISPENG-270][WISPENG-270]]: DoseSpotAPIMedicationV2 should accept 'RXCUI' and 'RxCUI'
** [X] [[https://github.com/hellowisp/secure.hellowisp.com/pull/4270][WISPENG-271]]: Adds guard clause to dosespot_drug_metadata property
** [X] Ask if we can get a provider onboard for the DoseSpot launch
- Note taken on [2024-06-20 Thu 14:05] \\
  Andrea will help us out here
** [X] Write a release plan for DoseSpot V2
*** [X] Rollback plan?
*** [X] Schedule of what's going to happen
*** [X] What's important to us?
*** [X] How do we make sure everything worked?
*** [X] Who is going to be doing tests, quick fixes?
*** [X] Section of metrics that we will be watching
**** [X] Find a dashboard in Datadog for fill requests
*** [X] Post-release plan
*** [X] Document the need to change the feature flag
*** [X] Docuement the need to change the subscription key
** [20/20] Document all possible Patient uses of the DoseSpot API
*** [X] CancelPrescription
*** [X] CopyPrescription
*** [X] CreateCodedFillRequestRx
*** [X] CreateFreeTextFillRequestRx
*** [X] CreateOrUpdatePatient
*** [X] DeletePendingRx
*** [X] GetClinicianAddress
*** [X] GetMedicationByNameAndStrength
*** [X] GetMedicationByNDC
*** [X] GetMedicationByRxcui
- Note taken on [2024-06-20 Thu 14:22] \\
  Check ~assert_dosespot_metadata~ usages.
*** [X] GetMedicationMonograph
*** [X] GetNotificationsCounts
*** [X] GetPatientPrescription
*** [X] GetPatientPrescriptions
*** [X] GetPharmacy
*** [X] GetSsoUrl
*** [X] SearchMedicationsByName
*** [X] SearchPharmacies
*** [X] SendPrescriptions
*** [X] UpdatePrescriptionPharmacy
** [X] Document which services need pagination
*** [X] GetPatientPrescriptions
*** [X] SearchMedicationsByName
*** [X] SearchPharmacies
* Misc [2/5]
** [?] [[https://github.com/hellowisp/secure.hellowisp.com/pull/4260][Unticketed PR]] to change SnoozeRequestMixin.missed_calls_count to be non-nullable
** [X] Remove feature flag for disabling DoseSpot API

** [ ] models.Patient.has_synchronous_state can return None
This method should only ever return True or False
** [ ] models.Patient.has_synchronous_state can cause memory leaks because of lru_cache
** [X] Un-fucking my local DB
*** [X] Copying migrations into the new migrations folder
:LOGBOOK:
CLOCK: [2024-08-26 Mon 17:22]--[2024-08-26 Mon 17:47] =>  0:25
:END:
* Editable Medications
** [X] WE-460: New Provider UI
** [X] Investigating UI failure for lab slips
- Note taken on [2024-08-27 Tue 07:06] \\
  Investigation lead to creation of WE-579
** [X] [[https://hellowisp.atlassian.net/browse/WISPENG-579][WISPENG-579]]
:LOGBOOK:
CLOCK: [2024-08-27 Tue 17:00]--[2024-08-27 Tue 18:27] =>  1:27
CLOCK: [2024-08-27 Tue 16:12]--[2024-08-27 Tue 16:37] =>  0:25
CLOCK: [2024-08-27 Tue 14:29]--[2024-08-27 Tue 15:27] =>  0:58
CLOCK: [2024-08-27 Tue 13:59]--[2024-08-27 Tue 14:24] =>  0:25
CLOCK: [2024-08-27 Tue 12:30]--[2024-08-27 Tue 12:42] =>  0:12
CLOCK: [2024-08-27 Tue 11:49]--[2024-08-27 Tue 12:14] =>  0:25
CLOCK: [2024-08-27 Tue 11:19]--[2024-08-27 Tue 11:44] =>  0:25
CLOCK: [2024-08-27 Tue 07:07]--[2024-08-27 Tue 07:32] =>  0:25
:END:
** NO Hotfix: old UI no longer updating FillRequests on Lab Slip submit
- Note taken on [2024-08-29 Thu 11:59] \\
  We probably don't need this. The new UI seems to be working fine.
:LOGBOOK:
CLOCK: [2024-08-29 Thu 09:05]--[2024-08-29 Thu 09:25] =>  0:20
:END:
** [-] Service method to get a Cart by ID
:PROPERTIES:
:DESCRIPTION: We need a service method to get carts by Cart ID. This will be used by the messaging system to display what changed in a user's cart.
:END:
:LOGBOOK:
CLOCK: [2024-08-29 Thu 16:45]--[2024-08-29 Thu 17:02] =>  0:17
CLOCK: [2024-08-29 Thu 16:13]--[2024-08-29 Thu 16:38] =>  0:25
:END:
** [-] WE-460 Tests
:LOGBOOK:
CLOCK: [2024-08-26 Mon 15:06]--[2024-08-26 Mon 15:31] =>  0:25
:END:
* Messages to post
** [ ] Ask in dev-private what everyone thinks about the type hint for returning "Self" from Pydantic validators.
We have two options:
- return ~typing_extensions.Self~
- return the same class name in quotes.

It doesn't /really/ matter much, but we should pick one and stick with it.

Note that ~Self~ is part of ~typing~ as of Python 3.11, but for now, we need to use ~typing_extensions~. Only mentioning this in case your IDE suggests importing from ~typing~ (mine did).



* Tests
** [ ] Move tests in tests/api/v3
These tests are misplaced. They should be in tests/app/controllers/api/v3
** [ ] ProductFactory.description should not be None
The DB does not have the column as nullabe, so this should not be ~None~ by default.

{"coupon_code": null, "coupon_codes": null, "discount_value": 0.0, "facebook_pixel_content_ids": ["334", "342", "312", "298", "314"], "flow_path": null, "form_id": "", "hostname": null, "line_items": "Acyclovir_800mg_(90ct)_Suppressive_onetime_localpickup,Ella_(Ulipristal_Oral:_30mg)_-_Add-on_onetime_localpickup,OMG!_Cream_-_Add-on_onetime_shipped,Lidocaine-Amitriptyline_Pain_Cream_-_Add-on_onetime_shipped,Acyclovir_10%_Topical_Cream_-_Add-on_onetime_shipped", "local_pickup": null, "order_spec": {"id": "00df3428-d326-47af-a3ad-81c0f6c56189", "fulfillment": {"shipping_address_id": 1234156, "billing_address_id": null, "pickup_pharmacy_id": 4816}, "line_items": [{"sku": "AcSu-OT-LP", "product_spec_id": "298", "cost": {"base": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "85", "actual": "85.00"}, "shipping": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "taxes": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "total": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "85", "actual": "85.00"}}, "id": "5384989c-e8fa-4d04-8b6a-3509ec7d1e5f", "returned": false, "attributes": {"is_emergency_dose": false, "is_reorder": false}, "fill_request_id": 4786042}, {"sku": "EU-A-OT-LP", "product_spec_id": "334", "cost": {"base": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "44", "actual": "44.00"}, "shipping": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "taxes": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "total": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "44", "actual": "44.00"}}, "id": "75abe2c7-987a-425b-9875-755a8e4cf687", "returned": false, "attributes": {"is_emergency_dose": false, "is_reorder": false}, "fill_request_id": 4786043}, {"sku": "OM1-A-OT-SH", "product_spec_id": "342", "cost": {"base": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "39", "actual": "39.00"}, "shipping": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "taxes": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "total": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "39", "actual": "39.00"}}, "id": "c7abb033-148b-4f57-98eb-463aa4f18281", "returned": false, "attributes": {"is_emergency_dose": false, "is_reorder": false}, "fill_request_id": 4786044}, {"sku": "LPC-A-OT-SH", "product_spec_id": "314", "cost": {"base": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "30", "actual": "30.00"}, "shipping": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "taxes": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "total": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "30", "actual": "30.00"}}, "id": "730d8d4e-5f43-43d9-a747-87ad603d0bae", "returned": false, "attributes": {"is_emergency_dose": false, "is_reorder": false}, "fill_request_id": 4786045}, {"sku": "AC-A-OT-SH", "product_spec_id": "312", "cost": {"base": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "33", "actual": "33.00"}, "shipping": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "taxes": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "total": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "33", "actual": "33.00"}}, "id": "83ef80e1-b6e5-43a7-8277-a3e74d1813a5", "returned": false, "attributes": {"is_emergency_dose": false, "is_reorder": false}, "fill_request_id": 4786046}], "patient_id": 1077139, "status": "PENDING", "payment_intent_id": "pi_3Psr97HmfL7lmDFx121Q4VLP", "cost": {"base": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "231", "actual": "231.00"}, "shipping": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "taxes": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "0", "actual": "0.00"}, "total": {"payments": {"out_of_pocket": "0", "store_credit": "0"}, "discounts": [], "original": "231", "actual": "231.00"}}, "currency_code": "USD", "tracking_tags": [], "add_on_order_id": null, "originated_from_subscription_renewal": false}, "original_order_total": 231.0, "pickup_fee": 0.0, "priority_groups": [{"product_spec_id": "298", "priority_group": null, "group_name": ""}, {"product_spec_id": "334", "priority_group": null, "group_name": ""}, {"product_spec_id": "342", "priority_group": null, "group_name": ""}, {"product_spec_id": "314", "priority_group": null, "group_name": ""}, {"product_spec_id": "312", "priority_group": null, "group_name": ""}], "product_flow_id": null, "products": null, "product_ids": "8405,8331,8336,8321,8394", "package_ids": "4708,4559,4573,4543,4683", "real_line_items": ["Acyclovir_800mg_(90ct)_Suppressive_onetime_localpickup", "Ella_(Ulipristal_Oral:_30mg)_-_Add-on_onetime_localpickup", "OMG!_Cream_-_Add-on_onetime_shipped", "Lidocaine-Amitriptyline_Pain_Cream_-_Add-on_onetime_shipped", "Acyclovir_10%_Topical_Cream_-_Add-on_onetime_shipped"], "remote_packages": [], "source": "checkout", "squarespace_flow": null, "stripe_payment_intent_id": "pi_3Psr97HmfL7lmDFx121Q4VLP", "total": "$231.00", "undiscounted_order_total": "$231.00", "msv": "nms", "pharmacy_routing_version": "1", "pharmacy_routing_log": ["EligibleSuppliers: OM1-A-OT-SH can be supplied by curexa.", "EligibleSuppliers: OM1-A-OT-SH can be supplied by precision.", "EligibleSuppliers: LPC-A-OT-SH can be supplied by curexa.", "EligibleSuppliers: LPC-A-OT-SH can be supplied by precision.", "EligibleSuppliers: AC-A-OT-SH can be supplied by curexa.", "EligibleSuppliers: AC-A-OT-SH can be supplied by precision.", "OrderConsolidation: curexa supports SKUs: {'OM1-A-OT-SH', 'AC-A-OT-SH', 'LPC-A-OT-SH'}", "OrderConsolidation: OM1-A-OT-SH at curexa weight modified: 0 -> 50.0", "OrderConsolidation: LPC-A-OT-SH at curexa weight modified: 0 -> 50.0", "OrderConsolidation: AC-A-OT-SH at curexa weight modified: 0 -> 50.0", "OrderConsolidation: precision supports SKUs: {'OM1-A-OT-SH', 'AC-A-OT-SH', 'LPC-A-OT-SH'}", "OrderConsolidation: OM1-A-OT-SH at precision weight modified: 0 -> 50.0", "OrderConsolidation: LPC-A-OT-SH at precision weight modified: 0 -> 50.0", "OrderConsolidation: AC-A-OT-SH at precision weight modified: 0 -> 50.0", "MinimumCapacity: curexa has fulfilled 100% of the contract minimum", "MinimumCapacity: OM1-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "MinimumCapacity: LPC-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "MinimumCapacity: AC-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "MinimumCapacity: precision has fulfilled 100% of the contract minimum", "MinimumCapacity: OM1-A-OT-SH at precision weight modified: 50.0 -> 50.0", "MinimumCapacity: LPC-A-OT-SH at precision weight modified: 50.0 -> 50.0", "MinimumCapacity: AC-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: OM1-A-OT-SH at curexa cost is above average by 0.00", "CostOptimization: OM1-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: LPC-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: AC-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: OM1-A-OT-SH at precision cost is above average by 0.00", "CostOptimization: OM1-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: LPC-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: AC-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: LPC-A-OT-SH at curexa cost is above average by 0.00", "CostOptimization: OM1-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: LPC-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: AC-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: LPC-A-OT-SH at precision cost is above average by 0.00", "CostOptimization: OM1-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: LPC-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: AC-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: AC-A-OT-SH at curexa cost is above average by 0.00", "CostOptimization: OM1-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: LPC-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: AC-A-OT-SH at curexa weight modified: 50.0 -> 50.0", "CostOptimization: AC-A-OT-SH at precision cost is above average by 0.00", "CostOptimization: OM1-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: LPC-A-OT-SH at precision weight modified: 50.0 -> 50.0", "CostOptimization: AC-A-OT-SH at precision weight modified: 50.0 -> 50.0", "IdealDistribution: curexa is below the target for 25%", "IdealDistribution: OM1-A-OT-SH at curexa weight modified: 50.0 -> 52.5", "IdealDistribution: LPC-A-OT-SH at curexa weight modified: 50.0 -> 52.5", "IdealDistribution: AC-A-OT-SH at curexa weight modified: 50.0 -> 52.5", "IdealDistribution: precision is below the target for 35%", "IdealDistribution: OM1-A-OT-SH at precision weight modified: 50.0 -> 53.5", "IdealDistribution: LPC-A-OT-SH at precision weight modified: 50.0 -> 53.5", "IdealDistribution: AC-A-OT-SH at precision weight modified: 50.0 -> 53.5"], "is_sti_treatment": false, "approved_frs": [4786048, 4786049, 4786050, 4786051, 4786052, 4786047]}
